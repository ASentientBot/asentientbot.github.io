<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="initial-scale=0.8">
<link rel="stylesheet" href="/common/style.css">
<script src="/common/scripts.js"></script>
<title>green ball</title>
</head>
<body onload="randomizeTitle()">
<div id="container">
<div id="header">
<div class="fixedWidth">
<h1><a id="title" href="/">green ball</a></h1>
</div>
</div>
<div class="fixedWidth">
<h1>clearing "permanent" battery failure</h1>
After an hour at -20 °C, my MacBook7,1 refused to charge and would shut off instantly when unplugged. The hardware was fine, but some parameter (likely cell voltage imbalance) temporarily crossed a failure threshold, and the chip disabled itself.
<br>
<br><h2>sources</h2>
I'm far from the first to do this, and I relied heavily on the following links.
<br><ul>
<li>René Rebe's <a target="_blank" href="https://reddit.com/r/macbook/comments/b8g9ik/">Reddit post</a> and (archived) <a target="_blank" href="https://web.archive.org/web/20210410071559/https://svn.exactcode.de/t2/trunk/package/base/linux/acpi-sbs-unbrick.diff">implementation</a> for Linux</li>
<li>Charlie Miller's DEF CON <a target="_blank" href="https://defcon.org/images/defcon-19/dc-19-presentations/Miller/DEFCON-19-Miller-Battery-Firmware-Hacking.pdf">slides</a> on hacking MacBook batteries</li>
<li>Texas Instruments bq20z80 <a target="_blank" href="http://www.ti.com/jp/lit/er/sluu276/sluu276.pdf">reference manual</a></li>
</ul>
<br><h2>implementation</h2>
This ugly-ish Objective-C <a href="/pf/pf.m">program</a> should clear the PF status from macOS userspace. You'll need this <a target="_blank" href="https://github.com/apple-oss-distributions/PowerManagement/blob/main/AppleSmartBatteryManager/AppleSmartBatteryCommands.h">header file</a> to build it.
<br>
<br><h2>result</h2>
It took a couple tries and/or a reboot to take effect, but the laptop accepts a charge and runs on battery again!
</div>
</div>
</body>
</html>